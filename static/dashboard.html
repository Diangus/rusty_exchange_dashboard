<!DOCTYPE html>
<html>
<head>
    <title>Market Data Stream</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body class="bg-slate-900 min-h-screen">
    <!-- Navigation Bar - Loaded dynamically -->
    <div id="navigation-container"></div>
    <div class="ml-16 container mx-auto px-4 py-8 max-w-7xl">
        <!-- Instrument Selector -->
        <div class="instrument-selector bg-slate-800 rounded-lg shadow-xl border border-slate-700 p-6 mb-8">
            <h2 class="text-xl font-semibold text-slate-200 mb-4">Select Instrument</h2>
            <div class="flex flex-col sm:flex-row gap-4 items-start sm:items-center">
                <div class="flex-1">
                    <select id="instrument-select" class="w-full bg-slate-700 border border-slate-600 text-slate-200 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="">Choose an instrument...</option>
                    </select>
                </div>
                <button id="go-button" disabled class="bg-blue-600 hover:bg-blue-700 disabled:bg-slate-600 text-white font-semibold py-2 px-6 rounded-lg transition-colors duration-200 flex items-center space-x-2">
                    <span>Go</span>
                    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M10.293 3.293a1 1 0 011.414 0l6 6a1 1 0 010 1.414l-6 6a1 1 0 01-1.414-1.414L14.586 11H3a1 1 0 110-2h11.586l-4.293-4.293a1 1 0 010-1.414z" clip-rule="evenodd"/>
                    </svg>
                </button>
            </div>
        </div>

        <!-- Page Title (hidden initially) -->
        <div class="page-title mb-8" style="display: none;">
            <h1 id="page-title" class="text-3xl font-bold text-slate-100 mb-2">Market Data Stream</h1>
            <p class="text-slate-400">Real-time orderbook updates and trades</p>
        </div>

        <!-- Market Data Container (hidden initially) -->
        <div id="market-data-container" style="display: none;">
            <div class="flex justify-between items-center mb-4">
                <div>
                    <p class="text-slate-400">Real-time orderbook updates and trades</p>
                </div>
                <button id="pauseButton" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-lg transition-colors duration-200 flex items-center space-x-2">
                    <svg id="pauseIcon" class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zM7 8a1 1 0 012 0v4a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v4a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd" />
                    </svg>
                    <svg id="playIcon" class="w-5 h-5 hidden" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" clip-rule="evenodd" />
                    </svg>
                    <span id="pauseText">Pause</span>
                </button>
            </div>

            <div class="stats bg-slate-800 rounded-lg shadow-xl border border-slate-700 p-6 mb-8" id="stats">
            <h2 class="text-xl font-semibold text-slate-200 mb-4">Statistics</h2>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                <div class="text-center">
                    <div class="text-2xl font-bold text-blue-400" id="msgCount">0</div>
                    <div class="text-sm text-slate-400">Messages received</div>
                </div>
                <div class="text-center">
                    <div class="text-2xl font-bold text-emerald-400" id="orderbookCount">0</div>
                    <div class="text-sm text-slate-400">Orderbook updates</div>
                </div>
                <div class="text-center">
                    <div class="text-2xl font-bold text-violet-400" id="tradeCount">0</div>
                    <div class="text-sm text-slate-400">Trades</div>
                </div>
                <div class="text-center">
                    <div class="text-2xl font-bold text-amber-400" id="lastPrice">-</div>
                    <div class="text-sm text-slate-400">Last price</div>
                </div>
            </div>
        </div>
        
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <div class="bg-slate-800 rounded-lg shadow-xl border border-slate-700 p-6" id="orderbook-table">
                <h2 class="text-xl font-semibold text-slate-200 mb-4">Order Book</h2>
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-slate-600">
                        <thead class="bg-slate-700">
                            <tr>
                                <th class="px-4 py-3 text-left text-xs font-medium text-slate-300 uppercase tracking-wider">Bid Volume</th>
                                <th class="px-4 py-3 text-center text-xs font-medium text-slate-300 uppercase tracking-wider">Price</th>
                                <th class="px-4 py-3 text-right text-xs font-medium text-slate-300 uppercase tracking-wider">Ask Volume</th>
                            </tr>
                        </thead>
                        <tbody class="bg-slate-800 divide-y divide-slate-700"></tbody>
                    </table>
                </div>
            </div>
            
            <div class="bg-slate-800 rounded-lg shadow-xl border border-slate-700 p-6" id="trades-table">
                <h2 class="text-xl font-semibold text-slate-200 mb-4">Recent Trades</h2>
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-slate-600">
                        <thead class="bg-slate-700">
                            <tr>
                                <th class="px-4 py-3 text-left text-xs font-medium text-slate-300 uppercase tracking-wider">Time</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-slate-300 uppercase tracking-wider">Instrument</th>
                                <th class="px-4 py-3 text-right text-xs font-medium text-slate-300 uppercase tracking-wider">Volume</th>
                                <th class="px-4 py-3 text-right text-xs font-medium text-slate-300 uppercase tracking-wider">Price</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-slate-300 uppercase tracking-wider">Buyer</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-slate-300 uppercase tracking-wider">Seller</th>
                            </tr>
                        </thead>
                        <tbody class="bg-slate-800 divide-y divide-slate-700"></tbody>
                    </table>
                </div>
            </div>
        </div>
        
            <div class="bg-slate-800 rounded-lg shadow-xl border border-slate-700 p-6 mt-8">
                <h2 class="text-xl font-semibold text-slate-200 mb-4">Market Chart - Last 5 Minutes</h2>
                <div id="market-chart" class="w-full" style="height: 400px;"></div>
            </div>
        </div>
    </div>

    <!-- Load Navigation Component -->
    <script>
        fetch('/navigation')
            .then(response => response.text())
            .then(html => {
                document.getElementById('navigation-container').innerHTML = html;
            })
            .catch(error => {
                console.error('Error loading navigation:', error);
                // Fallback: show basic navigation
                document.getElementById('navigation-container').innerHTML = `
                    <nav class="fixed left-0 top-0 h-full w-16 bg-slate-800 border-r border-slate-700 shadow-xl z-10">
                        <div class="p-4">
                            <div class="flex flex-col space-y-4 items-center">
                                <a href="/" class="flex items-center justify-center bg-slate-700 hover:bg-slate-600 text-slate-300 hover:text-white w-12 h-12 rounded-lg transition-colors duration-200" title="Home">
                                    <svg class="w-7 h-7" fill="currentColor" viewBox="0 0 20 20">
                                        <path d="M10.707 2.293a1 1 0 00-1.414 0l-9 9a1 1 0 001.414 1.414L4 12.414V15a3 3 0 003 3h2a3 3 0 003-3v-2.586l.293.293a1 1 0 001.414-1.414l-9-9z"/>
                                    </svg>
                                </a>
                                <a href="/dashboard" class="flex items-center justify-center bg-blue-600 hover:bg-blue-700 text-white w-12 h-12 rounded-lg transition-colors duration-200" title="Dashboard">
                                    <svg class="w-7 h-7" fill="currentColor" viewBox="0 0 20 20">
                                        <path d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 9a1 1 0 00-1 1v6a1 1 0 001 1h2a1 1 0 001-1v-6a1 1 0 00-1-1h-2z"/>
                                    </svg>
                                </a>
                            </div>
                        </div>
                    </nav>
                `;
            });
    </script>

    <!-- Market Data Application - ES6 Module Entry Point -->
    <script type="module" src="{{ url_for('static', filename='js/main.js') }}"></script>
    
    <!-- Fallback for browsers that don't support ES6 modules -->
    <script nomodule>
        document.body.innerHTML += `
            <div style="position: fixed; top: 0; left: 0; right: 0; background: #f59e0b; color: #1f2937; padding: 15px; z-index: 9999; text-align: center;">
                <strong>Browser Not Supported:</strong> This application requires a modern browser that supports ES6 modules. 
                Please update your browser or use Chrome/Firefox/Safari/Edge.
            </div>
        `;
        console.warn('ES6 modules not supported. Please update your browser.');
    </script>
</body>
</html>