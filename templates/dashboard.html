{% extends "base.html" %}

{% block title %}Market Data Stream{% endblock %}

{% block extra_head %}{% endblock %}

{% block content %}
<div class="header mb-8">
    <!-- Instrument Selection Section -->
    <div class="instrument-selector mb-6">
        <div class="flex items-center justify-center space-x-4 mb-4">
            <label for="instrument-select" class="text-lg font-semibold text-slate-200">Select Instrument:</label>
            <select id="instrument-select"
                class="bg-slate-700 border border-slate-600 text-slate-200 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                <option value="">Choose an instrument...</option>
                {% for instrument in instruments %}
                <option value="{{ instrument.name }}">{{ instrument.name }} ({{ instrument.underlying }})</option>
                {% endfor %}
            </select>
            <button id="go-button"
                class="bg-blue-600 hover:bg-blue-700 disabled:bg-slate-600 text-white font-semibold py-2 px-6 rounded-lg transition-colors duration-200"
                disabled>
                Go
            </button>
        </div>
    </div>

    <!-- Page Title (shown after instrument selection) -->
    <div class="page-title mb-8" style="display: none;">
        <div class="flex justify-between items-center mb-4">
            <div>
                <h1 id="page-title" class="text-3xl font-bold text-slate-100 mb-2">Rusty Exchange Dashboard</h1>
            </div>
            <button id="pauseButton"
                class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-lg transition-colors duration-200 flex items-center space-x-2">
                <svg id="pauseIcon" class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd"
                        d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zM7 8a1 1 0 012 0v4a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v4a1 1 0 102 0V8a1 1 0 00-1-1z"
                        clip-rule="evenodd" />
                </svg>
                <svg id="playIcon" class="w-5 h-5 hidden" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd"
                        d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z"
                        clip-rule="evenodd" />
                </svg>
                <span id="pauseText">Pause</span>
            </button>
        </div>
    </div>
</div>

<!-- Market Data Container (shown after instrument selection) -->
<div class="market-data" id="market-data-container" style="display: none;">
    <div class="stats bg-slate-800 rounded-lg shadow-xl border border-slate-700 p-6 mb-8" id="stats">
        <h2 class="text-xl font-semibold text-slate-200 mb-4">Statistics</h2>
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
            <div class="text-center">
                <div class="text-2xl font-bold text-blue-400" id="msgCount">0</div>
                <div class="text-sm text-slate-400">Messages received</div>
            </div>
            <div class="text-center">
                <div class="text-2xl font-bold text-emerald-400" id="orderbookCount">0</div>
                <div class="text-sm text-slate-400">Orderbook updates</div>
            </div>
            <div class="text-center">
                <div class="text-2xl font-bold text-violet-400" id="tradeCount">0</div>
                <div class="text-sm text-slate-400">Trades</div>
            </div>
            <div class="text-center">
                <div class="text-2xl font-bold text-amber-400" id="lastPrice">-</div>
                <div class="text-sm text-slate-400">Last price</div>
            </div>
        </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
        <div class="bg-slate-800 rounded-lg shadow-xl border border-slate-700 p-6" id="orderbook-table">
            <h2 class="text-xl font-semibold text-slate-200 mb-4">Order Book</h2>
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-slate-600">
                    <thead class="bg-slate-700">
                        <tr>
                            <th class="px-4 py-3 text-left text-xs font-medium text-slate-300 uppercase tracking-wider">
                                Bid Volume</th>
                            <th
                                class="px-4 py-3 text-center text-xs font-medium text-slate-300 uppercase tracking-wider">
                                Price</th>
                            <th
                                class="px-4 py-3 text-right text-xs font-medium text-slate-300 uppercase tracking-wider">
                                Ask Volume</th>
                        </tr>
                    </thead>
                    <tbody class="bg-slate-800 divide-y divide-slate-700"></tbody>
                </table>
            </div>
        </div>

        <div class="bg-slate-800 rounded-lg shadow-xl border border-slate-700 p-6" id="trades-table">
            <h2 class="text-xl font-semibold text-slate-200 mb-4">Recent Trades</h2>
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-slate-600">
                    <thead class="bg-slate-700">
                        <tr>
                            <th class="px-4 py-3 text-left text-xs font-medium text-slate-300 uppercase tracking-wider">
                                Time</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-slate-300 uppercase tracking-wider">
                                Instrument</th>
                            <th
                                class="px-4 py-3 text-right text-xs font-medium text-slate-300 uppercase tracking-wider">
                                Volume</th>
                            <th
                                class="px-4 py-3 text-right text-xs font-medium text-slate-300 uppercase tracking-wider">
                                Price</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-slate-300 uppercase tracking-wider">
                                Buyer</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-slate-300 uppercase tracking-wider">
                                Seller</th>
                        </tr>
                    </thead>
                    <tbody class="bg-slate-800 divide-y divide-slate-700"></tbody>
                </table>
            </div>
        </div>
    </div>

    <div class="bg-slate-800 rounded-lg shadow-xl border border-slate-700 p-6 mt-8">
        <h2 class="text-xl font-semibold text-slate-200 mb-4">Market Chart - Last 5 Minutes</h2>
        <div id="market-chart" class="w-full" style="height: 400px;"></div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<!-- Market Data Application - ES6 Module Entry Point -->
<script type="module" src="/static/js/main.js"></script>
{% endblock %}